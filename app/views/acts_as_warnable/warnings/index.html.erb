<% if params[:warnable_type] %>
  <h1>
    <%= link_to "#{params[:warnable_type].humanize} ##{params[:warnable_id]}", @warnable %> Warnings
  </h1>
<% else %>
  <h1>Warnings</h1>
<% end %>

<% if params[:active_only] %>
  <% if params[:warnable_type] %>
    <%= link_to "Show dismissed", send("#{params[:warnable_type].underscore}_warnings_path", params[:warnable_id]), { class: 'btn btn-info' } %>
  <% else %>
    <%= link_to "Show dismissed", ActsAsWarnable::Engine.routes.url_helpers.warnings_path, { class: 'btn btn-info' } %>
  <% end %>
<% else %>
  <% if params[:warnable_type] %>
    <%= link_to "Hide dismissed", send("#{params[:warnable_type].underscore}_warnings_path", params[:warnable_id], active_only: true), { class: 'btn btn-info' } %>
  <% else %>
    <%= link_to "Hide dismissed", ActsAsWarnable::Engine.routes.url_helpers.warnings_path(active_only: true), { class: 'btn btn-info' } %>
  <% end %>
<% end %>

<div>
  <%= paginate @warnings %>

  <table class='table table-striped'>
    <thead>
      <tr>
        <% if Warning.column_names.include?("created_at") %>
          <th>Date Issued</th>
        <% end %>
        <th>Warnable</th>
        <th>Warnable ID</th>
        <th>Warning</th>
        <th>Actions</th>
      </tr>
    </thead>

    <tbody>
      <% @warnings.each do |warning| %>
        <tr>
          <% if Warning.column_names.include?("created_at") %>
            <td><%= warning.created_at.try(:strftime, '%m/%d/%Y %I:%M%p') || '<unknown>' %></td>
          <% end %>
          <td><%= warning.warnable_type.underscore.humanize %></td>
          <td><%= warning.warnable_id %></td>
          <td><%= warning.message.truncate(50) %></td>
          <td>

            <%= link_to warning, data: { toggle: 'tooltip' }, class: 'btn btn-xs btn-success', title: 'Show' do %>
              <i class='glyphicon glyphicon-eye-open'></i>
            <% end %>

            <% unless warning.dismissed? %>
              <%= button_to_dismiss_warning warning, text: '<i class="glyphicon glyphicon-ok"></i>'.html_safe, data: { toggle: 'tooltip' }, class: 'btn btn-xs btn-primary', title: 'Dismiss' do %>
                <i class='glyphicon glyphicon-eye-open'></i>
              <% end %>
            <% end %>

          </td>
        </tr>
      <% end %>
    </tbody>
  </table>

  <%= paginate @warnings %>
</div>
